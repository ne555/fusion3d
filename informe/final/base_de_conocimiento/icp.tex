\section{\emph{Iterative Closest Point} (ICP)}
Dadas dos vistas, encontrar la transformación que las alinee.
¿Qué significa alinear?

¿Cómo determinamos la mejor alineación?
¿Cómo determinamos que una alineación es mejor que otra? 


Supongamos que dos nubes de puntos $A$ y $B$,
ambas con la misma cardinalidad,
de las cuales se conocen las correspondencias $a_j \to b_j$
para todos los puntos.
Podemos definir el error de alineación como:
\[
	\text{Error} = \frac{1}{N} \sum || b_j - T_{jk} a_k ||
\]
Se busca entonces la transformación $T_{jk}$ que minimice este error.

Sin embargo, las suposiciones propuestas son demasiado fuertes.
Al trabajar con dos vistas el solapamiento no será total, ya que habrá puntos que serán observables
en tan sólo una de las vistas, por lo que es necesario
determinar primeramente cuáles son los puntos comunes.
El algoritmo de ICP determina las correspondencias utilizando las propiedades geométricas.
\begin{enumerate}
	\item Obtener las correspondencias.
		Para cada $a_j \in A$ buscar el punto más cercano en $B$.
		Si la distancia entre estos puntos supera un umbral $\tau_1$
		se considera que el punto no pertenece a la zona común y es descartado.
	\item Calcular la transformación que alinee estos subconjuntos. 
	\item Aplicar la transformación.
	\item Repetir el proceso hasta que el error de alineación esté por debajo de un umbral $\tau_2$.
\end{enumerate}

Variante \emph{point-to-plane}

En esta variante del algoritmo ICP se utiliza la información
de las normales de la superficie.
Al considerar que los puntos de la nube fueron muestreados 2.5D
se pueden establecer ciertas restricciones.

Los puntos en $A$ y $B$ no son el mismo el mismo punto, pero pertenecen al
mismo plano.  Por esto podemos decir que conocemos con mucha confianza la
posición del punto a lo largo de su normal, pero no su ubicación en el plano
tangente.
Entonces se adopta otra medida del error para reflejar esta situación.
En lugar pedir coincidencia de las coordenadas de los puntos, buscamos que no
se encuentren demasiado fuera del plano
\[
	\argmin_{T} \left\{ n_j \text{Error}_j \right \}
\]

\endinput





%generalized icp
%darpa grand challenge

%icp está en a method for registration of 3d shapes
Dado un cuaternión $q$ y una translación $t$
se puede definir el vector de registración como $T = [q|t]$.
Tomando el conjunto de puntos $P = {p_j}$ a ser alineados
con el modelo $X = {x_j}$ ambos de la misma cardinalidad
y correspondiendo de la forma $p_j \rightarrow x_j$.
\Nota{se conocen todas las correspondencias de entrada}
La función objetivo a minimizar se define como
\[ f(T) = \frac{1}{N} \sum || x_j - q p_j - t || \]

Se calcula la matriz de covarianza cruzada de los conjuntos $P$ y $X$
\[ \Sigma_{px} = \frac{1}{N} p_j x_j - \mu_p \mu_x \]

Los componentes cíclicos \Nota{¿?} de la matriz $A_{jk} = \Sigma_{jk} - \Sigma_{kj}$
forman el vector $\Delta = [A_{23} A_{31} A_{12}]$
que arma la matriz simétrica de $4\times4$
\[
	Q = \left[
		traza(\Sigma) \Delta
		\Delta'   \quad  algo
		\right]
	\]

El eigenvector correspondiente al mayor eigenvalor es el cuaternión que produce la rotación óptima.
Para la translación
\[t = \mu_x - q \mu_p \]
\Nota{Supongo que cualquier punto funcionaría, total tenemos las correspondencias.
Nope, los puntos no coinciden exactamente, usar la media}

\Nota{Ahora define ICP}
Con cualquier P, busca los más cercanos en X, así establece las correspondencias,
cumpliéndose lo de la cardinalidad.

Buscar la mejor alineación de P en X.

Distancia entre un punto y el modelo
\[ d(p, X) = \min_{x \in X} ||x-p|| \]

Algoritmo

Dado $P$ con $N_p$ puntos y el modelo $X$

Inicialización $P_0 = P$, $T = \mbox{Identidad}$
\begin{enumerate}
	\item Obtener las correspondencias, es decir, para cada $p_j$ el punto más cercano en $X$.
		\Nota{¿qué pasa si no es recíproco o hay varios?}
	\item Calcular la registración óptima con la matriz mágica $Q$ \Nota{fórmula cerrada en point-to-point euclídeo}
	\item Aplicar la registración
	\item Iterar. Cortar cuando el error cuadrático medio baje de un umbral
		$\tau \sqrt{tr\left(\Sigma_x\right)}$ (adimensional, $\tau$ está en proporción del tamaño del modelo)
\end{enumerate}


Desventajas

susceptible a outliers \TODO{traducir}



%generalized icp
Problemas:
	supone que hay un solapamiento total entre las nubes a ser solapadas,
	requiere que los puntos provengan de una superficie geométrica conocida (no medido)

En realidad el solapamiento es parcial, \Nota{y con más razón en nuestro caso}.
Se resuelve con un umbral de cercanía.

Lo de superficie conocida jode con diferentes discretizaciones,
no se tiene una correspondencia exacta después de la convergencia. Resuelto por point-to-plane


En resumidas cuentas, ICP hace
\begin{enumerate}
	\item Calcula correspondencias
	\item Calcula la transformación que minimiza la distancia entre las correspondencias
\end{enumerate}

%object modeling 
%Introduce variante point-to-plane
\subsection{Point-to-plane}
Utiliza información de la normal de las superficies.
Es una variante más robusta y precisa de ICP al considerar imágenes 2.5D.
Dado el error de registración $ \mbox{error}_j = T_{jk} p_k - x_j$
En lugar de encontrar $T$ que minimice la norma del error, minimiza la proyección sobre la normal de la superficie objetivo
\[ \argmin_T \left\{ w_k n_j \mbox{error}_j \right\} \]

\subsection{Plane-to-plane}
Mejorar point-to-plane y aumentar la simetría del modelo \Nota{¿? ¿por qué me interesa eso?}
Generalized ICP toma información de ambas capturas

La clave de point-to-plane es que los puntos fueron muestreados 2.5D, no son arbitrarios.
Es un 2-manifold en 3-space \Nota{¿qué?} \Nota{2-manifold: la vecindad es una superficie}

Supone que los puntos están localmente en un plano. No muestreamos el mismísimo punto.
Cada punto sólo presenta una restricción a lo largo de su normal.
Alta covarianza en el plano, muy baja en la normal; es decir, conocemos con mucha confianza
la posición a lo largo de la normal, pero no estamos seguros de dónde está en el plano.

Eliminar correspondencias que den normales inconsistentes.
Puede verse como restricciones de movimiento para cada correspondencia.
Las correspondencia erróneas forman restricciones muy débiles en el alineamiento global \Nota{No entendí}

\Nota{y eso es todo lo que tenía para decir acerca de esto}

